<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - Fitness Tracker</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css" />
    <link rel="stylesheet" th:href="@{/css/login.css}" href="/css/login.css" />
  </head>
  <body>
    <!-- Common Menu -->
    <header class="topbar">
      <nav class="nav">
        <a class="nav__brand" th:href="@{/}">
          <svg class="icon icon--brand" viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M12 2a7 7 0 0 1 7 7v1h1a2 2 0 0 1 2 2v8h-6v-6H8v6H2v-8a2 2 0 0 1 2-2h1V9a7 7 0 0 1 7-7Z"
            />
          </svg>
          MyApp
        </a>
      </nav>
    </header>

    <main class="container login-page">
      <section class="card login-card">
        <header class="login-header">
          <h1>Register</h1>
          <p class="subtitle">
            Create your account and start your fitness journey
          </p>
        </header>

        <!-- Global Messages -->
        <div th:if="${param.success}" class="message message--success">
          <span class="message__icon">✅</span>
          <span>Account created successfully. You can now log in.</span>
        </div>

        <div th:if="${param.error}" class="message message--error">
          <span class="message__icon">⚠️</span>
          <span
            >Registration failed. Please check your details and try again.</span
          >
        </div>

        <div th:if="${param.email_taken}" class="message message--error">
          <span class="message__icon">⚠️</span>
          <span>
            This email address is already registered. Please use a different
            email or <a class="link" th:href="@{/login}">log in</a>.
          </span>
        </div>

        <!-- Registration Form -->
        <form
          th:action="@{/register}"
          th:object="${form}"
          method="post"
          class="form-grid"
        >
          <!-- CSRF (if active in Spring Security) -->
          <input
            type="hidden"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}"
          />

          <label for="username">Full Name</label>
          <input
            id="username"
            type="text"
            name="username"
            placeholder="Username..."
            required
          />

          <label for="email">Email Address</label>
          <input
            id="email"
            type="email"
            name="email"
            placeholder="example@domain.com"
            required
          />

          <label for="password">Password</label>
          <input
            id="password"
            type="password"
            name="password"
            placeholder="At least 8 characters"
            minlength="8"
            required
          />

          <label for="confirmPassword">Confirm Password</label>
          <input
            id="confirmPassword"
            type="password"
            name="confirmPassword"
            placeholder="Re-enter your password"
            minlength="8"
            required
          />
          <small id="passwordMismatch" class="field-error" style="display: none"
            >Passwords do not match.</small
          >

          <div class="checkbox-row">
            <input id="terms" type="checkbox" name="acceptTerms" required />
            <label for="terms"
              >I agree to the
              <a class="link" th:href="@{/terms}">Terms and Conditions</a
              >.</label
            >
          </div>

          <div class="form-actions">
            <button type="submit" class="btn submit-btn">Create Account</button>
          </div>
        </form>

        <div class="login-links">
          <a class="link" th:href="@{/login}"
            >Already have an account? Log in</a
          >
        </div>
      </section>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector("form");
        const submitBtn = document.querySelector(".submit-btn");
        const pwd = document.getElementById("password");
        const cpwd = document.getElementById("confirmPassword");
        const mismatch = document.getElementById("passwordMismatch");

        function checkMatch() {
          const ok = pwd.value && cpwd.value && pwd.value === cpwd.value;
          mismatch.style.display = ok ? "none" : cpwd.value ? "block" : "none";
          return ok;
        }

        pwd.addEventListener("input", checkMatch);
        cpwd.addEventListener("input", checkMatch);

        form.addEventListener("submit", function (e) {
          if (!checkMatch()) {
            e.preventDefault();
            cpwd.focus();
            return;
          }
          submitBtn.innerHTML =
            '<span class="loading"></span>Creating account...';
          submitBtn.disabled = true;
        });
      });
    </script>
  </body>
</html>
