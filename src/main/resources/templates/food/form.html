<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ro">
  <head>
    <meta charset="UTF-8" />
    <title th:text="${food.id} == null ? 'New Food' : 'Edit Food'">Food</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css" />
    <link rel="stylesheet" th:href="@{/css/foods.css}" href="/css/foods.css" />
  </head>
  <body>
    <header class="topbar">
      <nav class="nav">
        <a class="nav__brand" th:href="@{/}">MyApp</a>
        <ul class="nav__list">
          <li>
            <a class="nav__link" th:href="@{/}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24">
                  <path
                    d="M3 12l9-9 9 9-2 0v8h-5v-5H10v5H5v-8H3z"
                  /></svg></span
              >Home</a
            >
          </li>
          <li>
            <a class="nav__link" th:href="@{/journal}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24">
                  <path
                    d="M6 4h11a2 2 0 012 2v14l-3-2-3 2-3-2-3 2V6a2 2 0 012-2z"
                  /></svg></span
              >Journal</a
            >
          </li>
          <li sec:authorize="hasRole('ADMIN')">
            <a class="nav__link nav__link--active" th:href="@{/food}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24">
                  <path
                    d="M7 2h10l1 5H6l1-5zm-1 7h12l-1.5 13H7.5L6 9z"
                  /></svg></span
              >Foods</a
            >
          </li>
          <li>
            <a class="nav__link" th:href="@{/workout}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24">
                  <path
                    d="M5 6h2v12H5V6zm12 0h2v12h-2V6zM9 9h6v6H9V9z"
                  /></svg></span
              >Workouts</a
            >
          </li>
          <li sec:authorize="hasRole('ADMIN')">
            <a class="nav__link" th:href="@{/exercises}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24">
                  <path
                    d="M7 10h10v4H7zM3 11h3v2H3zm15 0h3v2h-3z"
                  /></svg></span
              >Exercises</a
            >
          </li>
          <li sec:authorize="hasRole('ADMIN')">
            <a class="nav__link" th:href="@{/admin/muscle-groups}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24"><path d="M4 8h16v8H4z" /></svg></span
              >Muscle Groups</a
            >
          </li>
          <li>
            <a class="nav__link" th:href="@{/profile}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24">
                  <path
                    d="M12 12a5 5 0 100-10 5 5 0 000 10zm-7 9v-1a7 7 0 0114 0v1H5z"
                  /></svg></span
              >Account</a
            >
          </li>
        </ul>
      </nav>
    </header>

    <main class="container">
      <h1 th:text="${food.id} == null ? 'New Food' : 'Edit Food'">Food</h1>

      <section class="card">
        <form
          class="form-grid"
          th:action="${food.id} == null ? @{/food} : @{'/food/' + ${food.id}}"
          th:object="${food}"
          method="post"
        >
          <!-- Dacă ai CSRF activ, decomentează linia de mai jos -->
          <!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /> -->

          <label for="name">Name</label>
          <div class="field">
            <input id="name" type="text" th:field="*{name}" required />
            <div
              class="error"
              th:if="${#fields.hasErrors('name')}"
              th:errors="*{name}"
            ></div>
          </div>

          <label for="category">Category</label>
          <div class="field">
            <select id="category" th:field="*{category.id}" required>
              <option
                th:each="c : ${categories}"
                th:value="${c.id}"
                th:text="${c.name}"
              ></option>
            </select>
            <div
              class="error"
              th:if="${#fields.hasErrors('category')}"
              th:errors="*{category}"
            ></div>
            <div
              class="error"
              th:if="${#fields.hasErrors('category.id')}"
              th:errors="*{category.id}"
            ></div>
          </div>

          <h3 class="form-subtitle">Macros (per 100g)</h3>

          <label for="fat">Fat (g/100g)</label>
          <input id="fat" type="number" th:field="*{fat}" min="0" step="0.1" />

          <label for="carbs">Carbs (g/100g)</label>
          <input
            id="carbs"
            type="number"
            th:field="*{carbs}"
            min="0"
            step="0.1"
          />

          <label for="protein">Protein (g/100g)</label>
          <input
            id="protein"
            type="number"
            th:field="*{protein}"
            min="0"
            step="0.1"
          />

          <label for="kcal">Kcal (computed)</label>
          <input id="kcal" type="number" th:field="*{kcal}" readonly />

          <div class="form-actions">
            <button class="btn" type="submit">Save</button>
            <a class="btn btn--ghost" th:href="@{/food}">Cancel</a>
          </div>
        </form>
      </section>
    </main>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const fat = document.getElementById("fat");
        const carbs = document.getElementById("carbs");
        const protein = document.getElementById("protein");
        const kcal = document.getElementById("kcal");

        function updateKcal() {
          const fatVal = parseFloat(fat.value) || 0;
          const carbsVal = parseFloat(carbs.value) || 0;
          const proteinVal = parseFloat(protein.value) || 0;
          const total = fatVal * 9 + carbsVal * 4 + proteinVal * 4;
          kcal.value = Math.round(total);
        }

        [fat, carbs, protein].forEach((input) =>
          input.addEventListener("input", updateKcal)
        );

        // calculează și la încărcare (dacă există valori deja)
        updateKcal();
      });
    </script>
  </body>
</html>
