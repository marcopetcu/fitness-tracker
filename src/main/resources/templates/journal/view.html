<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ro">
  <head>
    <meta charset="UTF-8" />
    <title>Daily Journal</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" href="/css/style.css" />
    <link
      rel="stylesheet"
      th:href="@{/css/journal.css}"
      href="/css/journal.css"
    />
  </head>
  <body>
    <header class="topbar">
      <nav class="nav">
        <a class="nav__brand" th:href="@{/}">MyApp</a>
        <ul class="nav__list">
          <li>
            <a class="nav__link" th:href="@{/}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24">
                  <path
                    d="M3 12l9-9 9 9-2 0v8h-5v-5H10v5H5v-8H3z"
                  /></svg></span
              >Home</a
            >
          </li>
          <li>
            <a class="nav__link nav__link--active" th:href="@{/journal}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24">
                  <path
                    d="M6 4h11a2 2 0 012 2v14l-3-2-3 2-3-2-3 2V6a2 2 0 012-2z"
                  /></svg></span
              >Journal</a
            >
          </li>
          <li sec:authorize="hasRole('ADMIN')">
            <a class="nav__link" th:href="@{/food}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24">
                  <path
                    d="M7 2h10l1 5H6l1-5zm-1 7h12l-1.5 13H7.5L6 9z"
                  /></svg></span
              >Foods</a
            >
          </li>
          <li>
            <a class="nav__link" th:href="@{/workout}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24">
                  <path
                    d="M5 6h2v12H5V6zm12 0h2v12h-2V6zM9 9h6v6H9V9z"
                  /></svg></span
              >Workouts</a
            >
          </li>
          <li sec:authorize="hasRole('ADMIN')">
            <a class="nav__link" th:href="@{/exercises}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24">
                  <path
                    d="M7 10h10v4H7zM3 11h3v2H3zm15 0h3v2h-3z"
                  /></svg></span
              >Exercises</a
            >
          </li>
          <li sec:authorize="hasRole('ADMIN')">
            <a class="nav__link" th:href="@{/admin/muscle-groups}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24"><path d="M4 8h16v8H4z" /></svg></span
              >Muscle Groups</a
            >
          </li>
          <li>
            <a class="nav__link" th:href="@{/profile}"
              ><span class="icon"
                ><svg viewBox="0 0 24 24">
                  <path
                    d="M12 12a5 5 0 100-10 5 5 0 000 10zm-7 9v-1a7 7 0 0114 0v1H5z"
                  /></svg></span
              >Account</a
            >
          </li>
        </ul>
      </nav>
    </header>

    <main class="container">
      <h1>Daily Journal</h1>

      <!-- Selector de zi -->
      <section class="card">
        <div class="date-selector">
          <a class="btn btn--ghost" th:href="@{|/journal?date=${prevDate}|}"
            >← Previous</a
          >
          <strong
            class="date-selector__date"
            th:text="${#temporals.format(date, 'yyyy-MM-dd')}"
            >date</strong
          >
          <a class="btn btn--ghost" th:href="@{|/journal?date=${nextDate}|}"
            >Next →</a
          >
        </div>

        <form class="date-jump" th:action="@{/journal}" method="get">
          <label for="date" class="sr-only">Alege data</label>
          <input id="date" type="date" name="date" th:value="${date}" />
          <button class="btn" type="submit">Go</button>
        </form>
      </section>

      <!-- Adăugare aliment -->
      <section class="card">
        <h2 class="section-title">Add food</h2>
        <form class="add-food" th:action="@{/journal/add}" method="post">
          <input type="hidden" name="date" th:value="${date}" />
          <div class="add-food-form-group">
            <label for="foodId" class="sr-only">Select food</label>
            <select id="foodId" name="foodId" required>
              <option value="" disabled selected>-- select food --</option>
              <option
                th:each="f : ${food}"
                th:value="${f.id}"
                th:text="${f.name + ' (' + f.kcal + ' kcal/100g)'}"
              ></option>
            </select>
          </div>
          <div class="add-food-form-group">
            <label for="grams" class="sr-only">Grams</label>
            <input
              id="grams"
              type="number"
              name="grams"
              min="1"
              step="1"
              placeholder="grams"
              required
            />
          </div>

          <button class="btn" type="submit">Add</button>

          <!-- Dacă ai CSRF activ pentru acest endpoint, decomentează: -->
          <!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"> -->
        </form>
      </section>

      <!-- Tabel intrări -->
      <section class="card">
        <div
          th:if="${journal == null or #lists.isEmpty(journal.food)}"
          class="empty-state"
        >
          <em>No entries for this date.</em>
        </div>

        <table
          class="table"
          th:if="${journal != null and !#lists.isEmpty(journal.food)}"
        >
          <thead>
            <tr>
              <th>Food</th>
              <th>Grams</th>
              <th>Kcal</th>
              <th>Fat</th>
              <th>Carbs</th>
              <th>Protein</th>
              <th class="col-actions">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="it : ${journal.food}">
              <td th:text="${it.food.name}">Food</td>
              <td th:text="${it.quantityGrams}">0</td>
              <td th:text="${it.totalKcal}">0</td>
              <td th:text="${it.totalFat}">0</td>
              <td th:text="${it.totalCarbs}">0</td>
              <td th:text="${it.totalProtein}">0</td>

              <td class="actions">
                <form
                  th:action="@{/journal/remove}"
                  method="post"
                  class="inline-form"
                >
                  <input type="hidden" name="date" th:value="${date}" />
                  <input type="hidden" name="foodId" th:value="${it.food.id}" />
                  <input
                    type="hidden"
                    th:name="${_csrf.parameterName}"
                    th:value="${_csrf.token}"
                  />
                  <button class="btn btn--danger" type="submit">Remove</button>
                </form>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <th>Total</th>
              <th>—</th>
              <th th:text="${totals.kcal}">0</th>
              <th th:text="${totals.fat}">0</th>
              <th th:text="${totals.carbs}">0</th>
              <th th:text="${totals.protein}">0</th>
              <th></th>
            </tr>
          </tfoot>
        </table>
      </section>
    </main>
  </body>
</html>
