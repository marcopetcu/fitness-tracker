<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head><meta charset="UTF-8"><title>Daily Journal</title></head>
<body>
<h1>Daily Journal</h1>

<div>
  <a th:href="@{|/journal?date=${prevDate}|}">← Previous</a>
  <strong th:text="${#temporals.format(date, 'yyyy-MM-dd')}">date</strong>
  <a th:href="@{|/journal?date=${nextDate}|}">Next →</a>
</div>

<form th:action="@{/journal}" method="get" style="margin-top:8px">
  <input type="date" name="date" th:value="${date}">
  <button type="submit">Go</button>
</form>

<h3>Add food</h3>
<form th:action="@{/journal/add}" method="post">
  <input type="hidden" name="date" th:value="${date}">
  <select name="foodId" required>
    <option value="" disabled selected>-- select food --</option>
    <option th:each="f : ${food}" th:value="${f.id}" th:text="${f.name + ' (' + f.kcal + ' kcal/100g)'}"></option>
  </select>
  <input type="number" name="grams" min="1" step="1" placeholder="grams" required>
  <button type="submit">Add</button>
</form>

<div th:if="${journal == null or #lists.isEmpty(journal.food)}" style="margin-top:16px">
  <em>No entries for this date.</em>
</div>

<table th:if="${journal != null and !#lists.isEmpty(journal.food)}" border="1" cellpadding="6" cellspacing="0" style="margin-top:16px">
  <thead>
  <tr><th>Food</th><th>Grams</th><th>Kcal</th><th>Fat</th><th>Carbs</th><th>Protein</th><th>Actions</th></tr>
  </thead>
  <tbody>
  <tr th:each="it : ${journal.food}">
    <td th:text="${it.food.name}">Food</td>
    <td th:text="${it.quantityGrams}">0</td>
    <td th:text="${T(java.lang.Math).round((it.food.kcal == null ? 0 : it.food.kcal) * (it.quantityGrams / 100.0))}">0</td>
    <td th:text="${((it.food.fat == null ? 0 : it.food.fat) * it.quantityGrams) / 100.0}">0</td>
    <td th:text="${((it.food.carbs == null ? 0 : it.food.carbs) * it.quantityGrams) / 100.0}">0</td>
    <td th:text="${((it.food.protein == null ? 0 : it.food.protein) * it.quantityGrams) / 100.0}">0</td>
    <td>
      <form th:action="@{/journal/remove}" method="post" style="display:inline">
        <input type="hidden" name="date" th:value="${date}">
        <input type="hidden" name="foodId" th:value="${it.food.id}">
        <button type="submit">Remove</button>
      </form>
    </td>
  </tr>
  </tbody>
  <tfoot>
  <tr>
    <th>Total</th>
    <th>—</th>
    <th th:text="${totals.kcal}">0</th>
    <th th:text="${totals.fat}">0</th>
    <th th:text="${totals.carbs}">0</th>
    <th th:text="${totals.protein}">0</th>
    <th></th>
  </tr>
  </tfoot>
</table>

<p style="margin-top:16px"><a th:href="@{/}">Home</a></p>
</body>
</html>
